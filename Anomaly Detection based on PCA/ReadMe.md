### 1. 基于PCA的异常值检测有两种思路：
---
**思路1：** 将数据映射到低维特征空间，然后在低维特征空间不同维度上查看每个数据点跟其它数据的偏差；

**思路2：** 将数据映射到低维特征空间，然后由低维特征空间重新映射回原空间，尝试用低维特征重构原始数据，看重构误差的大小；

<br>

### 2. 思路一：基于样本在各主成分上的偏离程度
---
#### 2.1 思路解析
- 样本点各个主成分上的累计偏差过高或过低，都有可能是异常样本

- 在靠前的主成分上偏差较大的样本，对应于在某些原始特征上取极值的异常样本

- 在靠后的主成分上偏差较大的样本，对应于那些与正常样本相关性结构不一致的异常样本

---
#### 2.2 样本在单个维度上的偏差
- 设`$e_j$`为低维空间的一个特征向量，则样本`$x_i$`在此特征方向上的偏离程度定义为 `$d_{ij} = (x_i^T e_j)^2 / \lambda_j$` 

- 其中除以特征值`$\lambda_j$`是为了起到归一化的作用，使得样本在不同特征向量上的偏差具有可比性
---

#### 2.3 样本在所有方向上的偏差之和等价于它与样本中心之间的马氏距离

- `$Score(x_i) = \sum_{j=1}^{n} d_{ij} = \sum_{j=1}^{n} (x_i^T e_j)^2 / \lambda_j $`

- 当`$Score(x_i)$` 大于某个阈值时，便可将样本`$x_i$`判定为异常样本
- 论文原文

![马氏距离](7755427582DE4460BDB21313FF04985B)
---

#### 2.4 **样本点在前`$q$`个或后`$r$`个特征向量方向上的偏差**
 
- `$\sum_{j=1}^{q} d_{ij} > C_1 \text{或} \sum_{j=n-r+1}^{n} d_{ij} > C_2$`，其中`$C_1$`和`$C_2$`为预先设定的阈值，若偏离程度大于阈值，则判定为异常值。

- 论文原文 

![判定](F16A540553F04717B4C81AEC653D5B1E)

- **`$q$`值的确定:** 
   - 前`$q$`个主成分能解释大约50%的总体方差，由此可确定`$q$`的取值；
   - 此`$q$`个主成分往往直接对应原始数据里的某几个特征，在这些特征上偏差比较大的样本点，往往就是在原始数据中那几个特征上的极值点；
 
- **`$r$`值的确定:** 
  - 后`$r$`个主成分对应的特征值均小于0.2；
  - 在后`$r$`个主成分上偏离越大的样本，越有可能是与正常相关性结构不一致的异常样本，即observations that do not have the same correlation structure as the normal instances；

- **论文原文：**

![前后主成分的确定](D4FD180E6B524696B73C7AC01559A634)

<br>

### 3. 思路二：基于样本的重构误差
---
#### 3.1 思路解析

- 异常样本具有**few and different**的特点，即异常样本占比较少，且特征构成与正常样本不一致。根据特征值的大小，对主成分降序排列，则靠前的主成分解释了大部分正常样本的方差，而最后的主成分主要解释了异常样本的方差。
![Inkedshouwei_LI](5430C79B4BE649E6BF0D4E30B4478536)


- 若只选取靠前的主成分用于重构初始特征空间，则异常样本无法被完整表出，异常样本引起的重构误差要远高于正常样本。因此，**重构过程中选取的主成分较少的情况下，重构误差越高的样本越有可能是异常样本**。

- 假设重构初始特征空间选取的主成分数量为`$k$`，则`$k$`增加到一定程度后，
正常样本重构误差的减小幅度越来越不明显，而异常样本重构误差的减小幅度会越来越明显。因此，**重构误差对应的权重应与k成正比，使得异常样本的加权重构误差明显高于正常样本的重构误差。**
---

#### 3.2 重构矩阵与重构样本

- **重构矩阵：** `$R^{k}_{m*n} = X_{m*n}Q_{n*k}Q^T_{k*n}$`，其中`$Q$`为投影矩阵，由协方差矩阵的特征向量构成；`$k$`为重构矩阵过程中用到的主成分个数；

- **重构误差：** 重构误差主要来自较小的特征值对应的特征向量方向上的信息

- **重构样本：** 对于数据样本`$x_i$`，其重构样本`$R_{i}^{k}$`为重构矩阵`$R^{k}$`的第`$i$`行
---

#### 3.3 异常分数计算公式
- **样本`$x_i$`的异常得分:** 
  
  `$Score(x_i) = \sum_{k=1}^{n} (|x_i - R_{i}^{k}|) * ev(k)$`,其中`$ev(k) = \sum_{j=1}^{k} \lambda_j / \sum_{j=1}^{n} \lambda_j$`

- **特征值与对应主成分上的偏差权重成反比:**   
`$ev(k)$`表示前`$k$`个主成分多大程度上解释了总体方差，与`$k$`值成正比。这也意味着重构矩阵用到的主成分越多，偏差`$|x_i - R_{i}^{k}|$`的权重越大
